<!DOCTYPE html>
<html>
<head>
    <title>Parameter Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .param { margin: 5px 0; padding: 5px; background: white; border-left: 3px solid #007acc; }
        .empty { border-left-color: #ff6b6b; background: #fff5f5; }
        .filled { border-left-color: #51cf66; background: #f3fff3; }
    </style>
</head>
<body>
    <h1>URL Parameter Debug</h1>
    
    <div class="debug">
        <h3>Current URL:</h3>
        <code id="current-url"></code>
    </div>
    
    <div class="debug">
        <h3>Parsed Parameters:</h3>
        <div id="params-list"></div>
    </div>
    
    <div class="debug">
        <h3>Quote Calculator Parameters:</h3>
        <div id="qc-params"></div>
    </div>

    <script>
        // Set up window.CFG
        window.CFG = {
            GMAPS_KEY: "AIzaSyDomK0QVxMj2SzgbwIkUdlBZ2nyYxRJSOI"
        };

        // Display current URL
        document.getElementById('current-url').textContent = window.location.href;
        
        // Parse and display all URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const paramsList = document.getElementById('params-list');
        
        if (urlParams.toString() === '') {
            paramsList.innerHTML = '<div class="param empty">No URL parameters found</div>';
        } else {
            for (const [key, value] of urlParams) {
                const isEmpty = !value || value.trim() === '';
                const className = isEmpty ? 'param empty' : 'param filled';
                paramsList.innerHTML += `<div class="${className}"><strong>${key}:</strong> "${value}" ${isEmpty ? '(EMPTY)' : '(OK)'}</div>`;
            }
        }
        
        // Test the quote calculator's getParam function
        const qs = new URLSearchParams(location.search);
        const getParam = (k) => {
            const v = qs.get(k);
            if (v && String(v).trim()) return v;
            try { return sessionStorage.getItem("lead:"+k) || ""; } catch { return ""; }
            if (window.LEAD_DATA && window.LEAD_DATA[k]) return window.LEAD_DATA[k];
            return "";
        };
        
        // Test quote calculator specific parameters
        const qcParams = document.getElementById('qc-params');
        const testParams = ['pickup_location', 'dropoff_location', 'passengers', 'pickup_date', 'pickup_time'];
        
        testParams.forEach(param => {
            const value = getParam(param);
            const isEmpty = !value || value.trim() === '';
            const className = isEmpty ? 'param empty' : 'param filled';
            qcParams.innerHTML += `<div class="${className}"><strong>${param}:</strong> "${value}" ${isEmpty ? '(MISSING - will cause error)' : '(FOUND - OK)'}</div>`;
        });
        
        // Show validation result
        const pickup = getParam("pickup_location");
        const dropoff = getParam("dropoff_location");
        const validationResult = (!pickup || !dropoff) ? 
            'FAIL - Quote calculator will show "Missing pickup or dropoff location"' : 
            'PASS - Quote calculator should work';
            
        qcParams.innerHTML += `<div class="debug"><strong>Validation Result:</strong> ${validationResult}</div>`;
    </script>
</body>
</html>