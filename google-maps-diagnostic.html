<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Maps API Diagnostic</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .api-key { font-family: monospace; background: #e9ecef; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Google Maps API Diagnostic Tool</h1>
    
    <div class="test">
        <h3>Current API Key</h3>
        <div class="api-key">AIzaSyD4gsEcGYTjqAILBU0z3ZNqEwyODGymXjA</div>
    </div>

    <div class="test">
        <h3>Required APIs for Quote Calculator</h3>
        <ul>
            <li><strong>Maps JavaScript API</strong> - For map display</li>
            <li><strong>Directions API</strong> - For route calculation</li>
            <li><strong>Places API</strong> - For location autocomplete</li>
        </ul>
    </div>

    <div id="test-results"></div>

    <div class="test">
        <h3>Test Route</h3>
        <p>Testing route: <strong>Sangster International Airport ‚Üí Negril Tree House Resort</strong></p>
        <div id="map" style="height: 400px; width: 100%; border: 1px solid #ccc;"></div>
    </div>

    <script>
        const API_KEY = 'AIzaSyD4gsEcGYTjqAILBU0z3ZNqEwyODGymXjA';
        const resultsDiv = document.getElementById('test-results');

        function addResult(title, status, message, details = '') {
            const className = status === 'success' ? 'success' : status === 'warning' ? 'warning' : 'error';
            const icon = status === 'success' ? '‚úÖ' : status === 'warning' ? '‚ö†Ô∏è' : '‚ùå';
            
            const div = document.createElement('div');
            div.className = `test ${className}`;
            div.innerHTML = `
                <h3>${icon} ${title}</h3>
                <p>${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            resultsDiv.appendChild(div);
        }

        // Test 1: Maps JavaScript API
        function testMapsAPI() {
            if (typeof google !== 'undefined' && google.maps) {
                addResult('Maps JavaScript API', 'success', 'Maps JavaScript API loaded successfully');
                return true;
            } else {
                addResult('Maps JavaScript API', 'error', 'Maps JavaScript API failed to load');
                return false;
            }
        }

        // Test 2: Places API
        function testPlacesAPI() {
            if (typeof google !== 'undefined' && google.maps && google.maps.places) {
                const service = new google.maps.places.PlacesService(document.createElement('div'));
                addResult('Places API', 'success', 'Places API is available');
                return true;
            } else {
                addResult('Places API', 'error', 'Places API is not available');
                return false;
            }
        }

        // Test 3: Directions API
        function testDirectionsAPI() {
            if (typeof google !== 'undefined' && google.maps) {
                const directionsService = new google.maps.DirectionsService();
                
                directionsService.route({
                    origin: 'Sangster International Airport, Jamaica',
                    destination: 'Negril Tree House Resort, Jamaica',
                    travelMode: google.maps.TravelMode.DRIVING
                }, (result, status) => {
                    if (status === 'OK') {
                        addResult('Directions API', 'success', 'Directions API working correctly', 
                            `Route found: ${Math.round(result.routes[0].legs[0].distance.value / 1000)} km, ${result.routes[0].legs[0].duration.text}`);
                        
                        // Display the route on map
                        const map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 9,
                            center: result.routes[0].bounds.getCenter()
                        });
                        
                        const directionsRenderer = new google.maps.DirectionsRenderer();
                        directionsRenderer.setMap(map);
                        directionsRenderer.setDirections(result);
                        
                    } else {
                        let errorMessage = 'Directions API request failed';
                        let details = `Status: ${status}`;
                        
                        switch(status) {
                            case 'REQUEST_DENIED':
                                errorMessage = 'Directions API access denied - check API key permissions';
                                details += '\n\nPossible causes:\n‚Ä¢ Directions API not enabled\n‚Ä¢ API key restrictions\n‚Ä¢ Billing not set up\n‚Ä¢ Invalid API key';
                                break;
                            case 'OVER_QUERY_LIMIT':
                                errorMessage = 'Directions API quota exceeded';
                                details += '\n\nYou have exceeded your daily quota or rate limit';
                                break;
                            case 'ZERO_RESULTS':
                                errorMessage = 'No route found between these locations';
                                break;
                            case 'UNKNOWN_ERROR':
                                errorMessage = 'Directions API server error - try again';
                                break;
                        }
                        
                        addResult('Directions API', 'error', errorMessage, details);
                    }
                });
            } else {
                addResult('Directions API', 'error', 'Google Maps not loaded - cannot test Directions API');
            }
        }

        // Load Google Maps API and run tests
        function loadGoogleMaps() {
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${API_KEY}&libraries=places&callback=runTests`;
            script.onerror = () => {
                addResult('API Loading', 'error', 'Failed to load Google Maps API', 
                    'Check your API key and internet connection');
            };
            document.head.appendChild(script);
        }

        // Run all tests
        window.runTests = function() {
            setTimeout(() => {
                testMapsAPI();
                testPlacesAPI();
                testDirectionsAPI();
            }, 100);
        };

        // Global error handler
        window.addEventListener('error', (e) => {
            addResult('JavaScript Error', 'error', e.message, `File: ${e.filename}\nLine: ${e.lineno}`);
        });

        // Start the diagnostic
        loadGoogleMaps();
    </script>

    <div class="test">
        <h3>üîß How to Fix Common Issues</h3>
        <ol>
            <li><strong>Enable Required APIs:</strong>
                <ul>
                    <li>Go to <a href="https://console.cloud.google.com/apis/library" target="_blank">Google Cloud Console ‚Üí APIs & Services ‚Üí Library</a></li>
                    <li>Search for and enable: "Maps JavaScript API", "Directions API", "Places API"</li>
                </ul>
            </li>
            <li><strong>Check API Key Restrictions:</strong>
                <ul>
                    <li>Go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console ‚Üí APIs & Services ‚Üí Credentials</a></li>
                    <li>Click on your API key</li>
                    <li>Under "Application restrictions", ensure your domain is allowed</li>
                    <li>Under "API restrictions", ensure all required APIs are selected</li>
                </ul>
            </li>
            <li><strong>Set up Billing:</strong>
                <ul>
                    <li>Google Maps APIs require a billing account</li>
                    <li>Go to <a href="https://console.cloud.google.com/billing" target="_blank">Google Cloud Console ‚Üí Billing</a></li>
                    <li>Add a payment method (you get $200 free credit monthly)</li>
                </ul>
            </li>
        </ol>
    </div>
</body>
</html>