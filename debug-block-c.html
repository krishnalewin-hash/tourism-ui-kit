<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Related Tours - Debug</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/krishnalewin-hash/tourism-ui-kit@main/src/tour-detail/css/block-c.css">
    <style>
        .debug-info {
            background: #f0f0f0;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="debug-info" id="debug-info">Loading debug info...</div>
    
    <div class="tdp3-wrap">
        <section class="related-tours-section" id="related-tours-section">
            <h2>Related Tours</h2>
            <h3>More Adventure Tours</h3>
            
            <!-- Skeleton loading -->
            <div class="related-tours-skeleton" id="related-tours-skeleton">
                <div class="tour-card-skeleton">
                    <div class="sk-image"></div>
                    <div class="sk-content">
                        <div class="sk-line lg" style="width:80%"></div>
                        <div class="sk-line sm" style="width:60%"></div>
                        <div class="sk-line" style="width:95%"></div>
                        <div class="sk-line" style="width:85%"></div>
                        <div class="sk-button"></div>
                    </div>
                </div>
                <div class="tour-card-skeleton">
                    <div class="sk-image"></div>
                    <div class="sk-content">
                        <div class="sk-line lg" style="width:80%"></div>
                        <div class="sk-line sm" style="width:60%"></div>
                        <div class="sk-line" style="width:95%"></div>
                        <div class="sk-line" style="width:85%"></div>
                        <div class="sk-button"></div>
                    </div>
                </div>
            </div>

            <!-- Related tours grid (hidden initially) -->
            <div class="related-tours-grid" id="related-tours-grid" style="display:none"></div>
        </section>
    </div>

    <script>
        window.CFG = {
            DATA_URL: 'https://tour-driver-data-proxy.krishna-0a3.workers.dev',
            CLIENT: 'tour-driver',
        };

        // Debug logging
        function updateDebugInfo(info) {
            const debugEl = document.getElementById('debug-info');
            if (debugEl) {
                debugEl.textContent = `DEBUG INFO (${new Date().toLocaleTimeString()}):
${JSON.stringify(info, null, 2)}`;
            }
        }

        // Test slug detection
        function getSlug() {
            const qp = new URLSearchParams(location.search);
            const qs = (qp.get('slug') || '').trim().toLowerCase();
            if (qs) return qs;
            const parts = (location.pathname || '/').split('/').filter(Boolean);
            const i = parts.indexOf('tours');
            return (i >= 0 && parts[i + 1]) ? parts[i + 1].toLowerCase() : (parts[parts.length - 1] || '').toLowerCase();
        }

        const detectedSlug = getSlug();
        
        updateDebugInfo({
            currentUrl: window.location.href,
            pathname: window.location.pathname,
            detectedSlug: detectedSlug,
            windowCFG: window.CFG,
            hasTourData: !!window.__TOUR_DATA__,
            tourDataKeys: window.__TOUR_DATA__ ? Object.keys(window.__TOUR_DATA__) : null
        });

        // Test API call
        async function testAPI() {
            try {
                const url = new URL(window.CFG.DATA_URL);
                url.searchParams.set('client', window.CFG.CLIENT);
                url.searchParams.set('mode', 'all');
                
                console.log('Testing API call:', url.toString());
                const response = await fetch(url.toString());
                const data = await response.json();
                
                updateDebugInfo({
                    currentUrl: window.location.href,
                    detectedSlug: detectedSlug,
                    apiUrl: url.toString(),
                    apiResponse: {
                        status: response.status,
                        hasToursArray: Array.isArray(data.tours),
                        toursCount: data.tours ? data.tours.length : 0,
                        tourTypes: data.tours ? [...new Set(data.tours.map(t => t.type))] : null,
                        sampleTour: data.tours && data.tours[0] ? {
                            slug: data.tours[0].slug,
                            name: data.tours[0].name,
                            type: data.tours[0].type
                        } : null
                    },
                    windowTourData: window.__TOUR_DATA__ ? Object.keys(window.__TOUR_DATA__) : null
                });
            } catch (error) {
                updateDebugInfo({
                    error: error.message,
                    detectedSlug: detectedSlug
                });
            }
        }

        // Run test after 1 second
        setTimeout(testAPI, 1000);
    </script>
    <script src="https://cdn.jsdelivr.net/gh/krishnalewin-hash/tourism-ui-kit@main/src/tour-detail/js/block-c.js"></script>
</body>
</html>