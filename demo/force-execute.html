<!DOCTYPE html>
<html>
<head>
    <title>Force Execute Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        #quote-calc { border: 2px solid #007cba; padding: 20px; margin: 20px 0; min-height: 200px; background: #f9f9f9; }
        .log { background: #1a1a1a; color: #00ff00; padding: 10px; font-family: monospace; font-size: 12px; border-radius: 4px; margin: 10px 0; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Force Execute Quote Calculator</h1>
    
    <div id="log" class="log"></div>
    
    <div id="quote-calc">
        ORIGINAL MOUNT POINT CONTENT - Should be replaced
    </div>
    
    <script>
        const logDiv = document.getElementById('log');
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        // Configuration
        window.CFG = {
            GMAPS_KEY: "AIzaSyD4gsEcGYTjqAILBU0z3ZNqEwyODGymXjA"
        };
        
        // Force URL parameters
        const params = new URLSearchParams();
        params.set('pickup_location', 'MBJ Airport');
        params.set('dropoff_location', 'Negril Beach Resort');
        params.set('passengers', '3');
        
        if (!window.location.search) {
            window.history.replaceState({}, '', '?' + params.toString());
            log('URL parameters set: ' + params.toString());
        }
        
        log('Starting force execute test...');
        log('Configuration: ' + JSON.stringify(window.CFG));
        log('Mount point exists: ' + !!document.getElementById('quote-calc'));
        
        // Load CSS
        const css = document.createElement('link');
        css.rel = 'stylesheet';
        css.href = '../dist/quote-calc.css';
        css.onload = () => log('CSS loaded');
        css.onerror = () => log('CSS failed');
        document.head.appendChild(css);
        
        // Load JS and force execution
        const js = document.createElement('script');
        js.src = '../dist/quote-calc.js';
        
        js.onload = function() {
            log('JavaScript loaded');
            
            setTimeout(() => {
                log('Checking QuoteCalc object...');
                
                if (window.QuoteCalc) {
                    log('✅ QuoteCalc object found');
                    log('Config: ' + JSON.stringify(window.QuoteCalc._config));
                    
                    log('Forcing manual execution...');
                    try {
                        window.QuoteCalc.run();
                        log('✅ Manual run executed');
                    } catch (error) {
                        log('❌ Manual run failed: ' + error.message);
                        log('Error stack: ' + error.stack);
                    }
                } else {
                    log('❌ QuoteCalc object not found');
                    log('Available window properties: ' + Object.keys(window).filter(k => k.includes('Quote')));
                }
                
                // Check mount point changes
                setTimeout(() => {
                    const mountContent = document.getElementById('quote-calc').innerHTML;
                    log('Mount point content after 2s: ' + mountContent.substring(0, 100));
                }, 2000);
                
            }, 500);
        };
        
        js.onerror = function() {
            log('❌ JavaScript failed to load');
        };
        
        document.head.appendChild(js);
        
        // Also set up sessionStorage as fallback
        try {
            sessionStorage.setItem('lead:pickup_location', 'MBJ Airport');
            sessionStorage.setItem('lead:dropoff_location', 'Negril Beach Resort');
            sessionStorage.setItem('lead:passengers', '3');
            log('SessionStorage fallback set');
        } catch (e) {
            log('SessionStorage failed: ' + e.message);
        }
    </script>
</body>
</html>