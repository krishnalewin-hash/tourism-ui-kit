<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passenger URL Parameter Test</title>
    <style>
        body { font-family: system-ui; max-width: 800px; margin: 50px auto; padding: 20px; }
        .test-form { background: #f9f9f9; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .debug { background: #fff3cd; padding: 15px; border-radius: 4px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Passenger URL Parameter Test</h1>
    
    <div class="debug">
        <strong>Current URL:</strong> <span id="current-url"></span><br>
        <strong>number_of_passengers param:</strong> <span id="passengers-param"></span><br>
        <strong>Input field value:</strong> <span id="input-value"></span><br>
        <strong>Select field value:</strong> <span id="select-value"></span>
    </div>

    <!-- Simulate GHL form structure -->
    <div class="test-form">
        <h3>Simulated GHL Form</h3>
        
        <!-- Hidden input that GHL form submission uses -->
        <input type="text" name="number_of_passengers" data-q="number_of_passengers" placeholder="Number of passengers" style="margin: 10px 0; padding: 8px; width: 200px;">
        
        <!-- Other form fields for context -->
        <input type="text" name="pickup_location" data-q="pickup_location" placeholder="Pickup location" style="margin: 10px 0; padding: 8px; width: 200px; display: block;">
        <input type="text" name="first_name" data-q="first_name" placeholder="First name" style="margin: 10px 0; padding: 8px; width: 200px; display: block;">
    </div>

    <!-- Debug buttons -->
    <button onclick="debugFields()">Debug Fields</button>
    <button onclick="testURLParams()">Test URL Params</button>
    <button onclick="simulateFormSubmit()">Simulate Form Submit</button>

    <!-- Configuration -->
    <script>
        window.CFG = {
            GMAPS_KEY: 'AIzaSyDomK0QVxMj2SzgbwIkUdlBZ2nyYxRJSOI',
            COUNTRIES: ['jm'],
            PLACES: {
                FIELDS: ['place_id','formatted_address','geometry','name','types'],
                TYPES: ['establishment'],
                PRIORITY_KEYWORDS: {
                    airport: ['airport','international airport','terminal','mbj','kin','ocj','neg','ktp'],
                    hotel: ['hotel','resort','inn','villa','guest house','guesthouse','lodgings','spa','apartments','suite','suites','bnb']
                }
            }
        };
    </script>

    <!-- Load the fixed component -->
    <link rel="stylesheet" href="./dist/quote-request-form.min.css">
    <script src="./dist/quote-request-form.min.js"></script>

    <script>
        // Debug functions
        function updateDebugInfo() {
            document.getElementById('current-url').textContent = window.location.href;
            
            const urlParams = new URLSearchParams(window.location.search);
            document.getElementById('passengers-param').textContent = urlParams.get('number_of_passengers') || 'NOT SET';
            
            const input = document.querySelector('[data-q="number_of_passengers"]');
            document.getElementById('input-value').textContent = input ? `"${input.value}"` : 'FIELD NOT FOUND';
            
            const select = document.querySelector('select[data-q="number_of_passengers"]');
            document.getElementById('select-value').textContent = select ? `"${select.value}"` : 'SELECT NOT FOUND';
        }

        function debugFields() {
            console.log('=== FIELD DEBUG ===');
            console.log('Input field:', document.querySelector('[data-q="number_of_passengers"]'));
            console.log('Select field:', document.querySelector('select[data-q="number_of_passengers"]'));
            console.log('All fields with number_of_passengers:', document.querySelectorAll('[data-q="number_of_passengers"], [name="number_of_passengers"]'));
            updateDebugInfo();
        }

        function testURLParams() {
            // Add passenger parameter to current URL
            const url = new URL(window.location);
            url.searchParams.set('number_of_passengers', '3');
            url.searchParams.set('pickup_location', 'Sangster International Airport');
            url.searchParams.set('first_name', 'Test User');
            window.history.pushState({}, '', url);
            
            // Reinitialize the component
            if (window.BookingForm && window.BookingForm.initNow) {
                window.BookingForm.initNow();
            }
            
            setTimeout(updateDebugInfo, 500);
        }

        function simulateFormSubmit() {
            const form = document.querySelector('.test-form');
            const formData = new FormData();
            
            // Collect all form fields
            form.querySelectorAll('input, select').forEach(field => {
                if (field.name && field.value) {
                    formData.append(field.name, field.value);
                }
            });
            
            // Show what would be submitted
            console.log('=== FORM SUBMISSION DATA ===');
            for (let [key, value] of formData.entries()) {
                console.log(`${key}: "${value}"`);
            }
            
            // Show URL that would be generated
            const params = new URLSearchParams(formData);
            console.log('Generated URL params:', params.toString());
        }

        // Initial debug update
        setTimeout(() => {
            updateDebugInfo();
            debugFields();
        }, 1000);

        // Update debug info when fields change
        document.addEventListener('change', updateDebugInfo);
        document.addEventListener('input', updateDebugInfo);
    </script>
</body>
</html>