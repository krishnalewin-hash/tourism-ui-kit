<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quote Calculator Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe6e6; border-left: 4px solid #ff0000; }
        .success { background: #e6ffe6; border-left: 4px solid #00ff00; }
    </style>
</head>
<body>
    <h1>Quote Calculator Debug Test</h1>
    
    <div class="debug">
        <h3>Step 1: Check if container exists</h3>
        <div id="container-check">Checking...</div>
    </div>

    <div class="debug">
        <h3>Step 2: Check if window.CFG is loaded</h3>
        <div id="config-check">Checking...</div>
    </div>

    <div class="debug">
        <h3>Step 3: Check if CSS is loaded</h3>
        <div id="css-check">Checking...</div>
    </div>

    <div class="debug">
        <h3>Step 4: Check if JS is loaded</h3>
        <div id="js-check">Checking...</div>
    </div>

    <div class="debug">
        <h3>Step 5: URL Parameters</h3>
        <div id="params-check">Checking...</div>
    </div>

    <hr>

    <!-- Quote Calculator Widget -->
    <div id="quote-calc" style="border: 2px dashed #ccc; min-height: 200px; padding: 20px;">
        <p>Quote calculator should appear here...</p>
    </div>

    <script>
    // Load client configuration
    window.CFG = {
      "GMAPS_KEY": "AIzaSyD4gsEcGYTjqAILBU0z3ZNqEwyODGymXjA",
      "COUNTRIES": ["jm"],
      "PLACES": {
        "FIELDS": ["place_id","formatted_address","geometry","name","types"],
        "TYPES": ["establishment"],
        "PRIORITY_KEYWORDS": {
          "airport": ["airport","international airport","terminal","mbj","kin","ocj","neg","ktp"],
          "hotel": ["hotel","resort","inn","villa","guest house","guesthouse","lodgings","spa","apartments","suite","suites","bnb"]
        }
      },
      "PRICING_RATES": {
        "BASE_RATES": {"SEDAN": 120, "SUV": 150, "MINIVAN": 180},
        "DISTANCE_BANDS": [
          {"maxKm": 15, "multiplier": 1.0},
          {"maxKm": 30, "multiplier": 1.2},
          {"maxKm": 50, "multiplier": 1.4},
          {"maxKm": 100, "multiplier": 1.8},
          {"maxKm": 999, "multiplier": 2.2}
        ],
        "REMOTE_AREAS": {
          "THRESHOLD_KM": 75,
          "SURCHARGE_USD": 25
        }
      }
    };

    // Debug checks
    function runDebugChecks() {
        // Step 1: Container check
        const container = document.getElementById('quote-calc');
        document.getElementById('container-check').innerHTML = container ? 
            '<span class="success">✅ Container found</span>' : 
            '<span class="error">❌ Container not found</span>';

        // Step 2: Config check
        document.getElementById('config-check').innerHTML = window.CFG ? 
            '<span class="success">✅ window.CFG loaded</span>' : 
            '<span class="error">❌ window.CFG not found</span>';

        // Step 5: URL Parameters
        const urlParams = new URLSearchParams(window.location.search);
        const params = {};
        for (const [key, value] of urlParams) {
            params[key] = value;
        }
        document.getElementById('params-check').innerHTML = 
            '<pre>' + JSON.stringify(params, null, 2) + '</pre>';
    }

    // Run initial checks
    document.addEventListener('DOMContentLoaded', runDebugChecks);

    // Check CSS loading
    function checkCSS() {
        const links = document.querySelectorAll('link[href*="quote-calc.css"]');
        if (links.length > 0) {
            document.getElementById('css-check').innerHTML = '<span class="success">✅ CSS link found</span>';
        } else {
            document.getElementById('css-check').innerHTML = '<span class="error">❌ CSS link not found</span>';
        }
    }

    // Check JS loading
    function checkJS() {
        const scripts = document.querySelectorAll('script[src*="quote-calc.js"]');
        if (scripts.length > 0) {
            document.getElementById('js-check').innerHTML = '<span class="success">✅ JS script found</span>';
        } else {
            document.getElementById('js-check').innerHTML = '<span class="error">❌ JS script not found</span>';
        }
    }

    setTimeout(() => {
        checkCSS();
        checkJS();
    }, 100);

    // Global error handler
    window.addEventListener('error', function(e) {
        console.error('Global error:', e.error);
        const errorDiv = document.createElement('div');
        errorDiv.className = 'debug error';
        errorDiv.innerHTML = `<strong>JavaScript Error:</strong> ${e.message} at ${e.filename}:${e.lineno}`;
        document.body.appendChild(errorDiv);
    });
    </script>

    <!-- Load CSS and JS from CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/krishnalewin-hash/tourism-ui-kit@main/dist/quote-calc.css">
    <script src="https://cdn.jsdelivr.net/gh/krishnalewin-hash/tourism-ui-kit@main/dist/quote-calc.js"></script>

    <script>
    // Wait for everything to load and then check if quote calculator initialized
    window.addEventListener('load', function() {
        setTimeout(() => {
            const container = document.getElementById('quote-calc');
            if (container && container.innerHTML.includes('Quote calculator should appear here')) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'debug error';
                statusDiv.innerHTML = '<strong>⚠️ Quote calculator did not initialize</strong>';
                document.body.appendChild(statusDiv);
            }
        }, 2000);
    });
    </script>
</body>
</html>