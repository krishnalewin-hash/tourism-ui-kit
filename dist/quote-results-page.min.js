var QuoteResults=(()=>{(function(){let p="quote-calc",t={...{googleApiKey:window.CFG&&(window.CFG.GMAPS_KEY||window.CFG.PLACES_API_KEY)||"",bands:[{maxMi:10,pricePP:30},{maxMi:20,pricePP:40},{maxMi:40,pricePP:55},{maxMi:999,pricePP:70}],minPricePP:30,defaultPassengers:1,remote:{keywords:["tryall","round hill","dublin castle","anchovy","greenwood","bluefields","sheffield","orange bay","rhodes hall"],surchargePP:5},map:{zoom:9}}},G=["pickup_location","dropoff_location","pickup_date","pickup_time","passengers","number_of_passengers","first_name","last_name","email","phone"];async function w(){try{let e=window.CFG?.client||new URLSearchParams(location.search).get("client")||sessionStorage.getItem("client")||"demo",o=window.CFG?.base||"krishnalewin-hash/tourism-ui-kit@main",s;o.startsWith("../")||o.startsWith("./")||o.startsWith("/")?s=`${o}/clients/${e}.json`:s=`https://cdn.jsdelivr.net/gh/${o}/clients/${e}.json`,console.log(`[quote-calc] Loading client config: ${e} from ${s}`);let n=await fetch(s,{cache:"no-store"});if(!n.ok)return console.warn(`[quote-calc] Failed to load client config for "${e}", using defaults`),t;let i=await n.json();return i.QUOTE_RESULTS_CONFIG?t={...t,...i.QUOTE_RESULTS_CONFIG}:i.PRICING_RATES&&b(i.PRICING_RATES),i.FORM_CONFIG?.GMAPS_KEY&&(t.googleApiKey=i.FORM_CONFIG.GMAPS_KEY),console.log(`[quote-calc] Loaded config for client: ${e}`,t),t}catch(e){return console.error("[quote-calc] Error loading client config:",e),t}}function b(e){if(e.DISTANCE_BANDS&&e.BASE_RATES){let o=e.BASE_RATES.SEDAN||120;t.bands=e.DISTANCE_BANDS.map(s=>({maxMi:Math.round(s.maxKm*.621371),pricePP:Math.round(o*s.multiplier)})),e.REMOTE_AREAS&&(t.remote.surchargePP=e.REMOTE_AREAS.SURCHARGE_USD||5)}else e.zones&&console.log("[quote-calc] Zone-based pricing detected, using default distance bands")}let M=new URLSearchParams(location.search),a=e=>{let o=M.get(e);if(o&&String(o).trim())return o;try{return sessionStorage.getItem("lead:"+e)||""}catch{return""}return window.LEAD_DATA&&window.LEAD_DATA[e]?window.LEAD_DATA[e]:""},h=e=>String(e||"").replace(/[<>&"']/g,o=>({"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"})[o]),k=e=>(e||0).toFixed(1)+" miles",A=e=>Math.round((e||0)/60)+" minutes";function E(e){for(let o of t.bands)if(e<o.maxMi)return o.pricePP;return t.bands[t.bands.length-1].pricePP}function S(e,o){let s=(e+" "+o).toLowerCase();for(let n of t.remote.keywords)if(s.includes(n))return t.remote.surchargePP;return 0}function C(e){let{pickup:o,dropoff:s,miles:n,seconds:i,pp:r,total:l,pax:d}=e;return`
      <div class="qc-row">
        <div>
          <div id="qc-map" class="qc-map qc-shimmer" aria-label="Route map"></div>
        </div>

        <div class="qc-details">
          <div class="qc-detail-item">
            <span class="qc-detail-label">From:</span>
            <span class="qc-detail-value">${h(o)}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">To:</span>
            <span class="qc-detail-value">${h(s)}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">Distance:</span>
            <span class="qc-detail-value">${k(n)}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">Est. Duration:</span>
            <span class="qc-detail-value">${A(i)}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">Number of Passengers:</span>
            <span class="qc-detail-value">${d||t.defaultPassengers}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">Cost per person:</span>
            <span class="qc-detail-value">$${r}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">Total Cost:</span>
            <span class="qc-detail-value highlight">$${l}</span>
          </div>
          
          <div class="qc-buttons">
            <button class="qc-btn qc-btn-primary" onclick="handlePayNow()">Pay Now</button>
            <button class="qc-btn qc-btn-secondary" onclick="handleContactUs()">Contact Us</button>
          </div>
        </div>
      </div>
    `}function T(){return`
      <div class="qc-row">
        <div class="qc-shimmer" style="height:400px;border-radius:12px;"></div>
        <div class="qc-shimmer" style="height:400px;border-radius:12px;"></div>
      </div>
    `}function y(e){if(window.google&&google.maps&&google.maps.DirectionsService)return e();let o=t.googleApiKey;if(!o){console.error("[quote-calc] Missing Google Maps API key"),e("no-key");return}if(document.querySelector("script[data-qc-gmaps]")){let n=()=>window.google?.maps?.DirectionsService?e():setTimeout(n,100);n();return}let s=document.createElement("script");s.src=`https://maps.googleapis.com/maps/api/js?key=${o}&libraries=places`,s.setAttribute("data-qc-gmaps","1"),s.onload=()=>e(),s.onerror=()=>{console.error("[quote-calc] Failed to load Google Maps"),e("load-error")},document.head.appendChild(s)}async function P(){let e=document.getElementById(p);if(!e){console.warn(`[quote-calc] No element #${p} found`);return}let o=a("pickup_location"),s=a("dropoff_location");if(!o||!s){e.innerHTML='<div class="qc-error">Missing pickup or dropoff location</div>';return}e.innerHTML=T();try{await w()}catch(n){console.warn("[quote-calc] Failed to load client config, using defaults:",n)}y(n=>{if(n){e.innerHTML=`<div class="qc-error">Could not load Google Maps: ${n}</div>`;return}new google.maps.DirectionsService().route({origin:o,destination:s,travelMode:google.maps.TravelMode.DRIVING},(r,l)=>{if(l!=="OK"){e.innerHTML=`<div class="qc-error">Couldn't calculate the route right now. Please try again.</div>`,console.error("[quote-calc] Directions failed:",l);return}let d=r.routes[0].legs[0],c=(d.distance?.value||0)/1609.344,m=d.duration?.value||0,f=a("passengers")||a("number_of_passengers"),v=f&&parseInt(f)>0?parseInt(f):t.defaultPassengers,I=E(c),D=S(o,s),_=Math.max(t.minPricePP,I+D),L=Math.round(_*v),g=document.createElement("div");g.id=p,g.innerHTML=C({pickup:o,dropoff:s,miles:Math.round(c*10)/10,seconds:m,pax:v,pp:_,total:L}),e.replaceWith(g);let q=document.getElementById("qc-map"),$=new google.maps.Map(q,{zoom:t.map.zoom||9});new google.maps.DirectionsRenderer({map:$}).setDirections(r),q.classList.remove("qc-shimmer")})})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",P):P(),window.handlePayNow=function(){let e=a("pickup_location"),o=a("dropoff_location"),s=a("pickup_date"),n=a("pickup_time"),i=a("passengers")||a("number_of_passengers")||t.defaultPassengers,r=a("first_name"),l=a("last_name"),d=a("email"),u=a("phone"),c=new URLSearchParams;e&&c.set("pickup_location",e),o&&c.set("dropoff_location",o),s&&c.set("pickup_date",s),n&&c.set("pickup_time",n),i&&c.set("passengers",i),r&&c.set("first_name",r),l&&c.set("last_name",l),d&&c.set("email",d),u&&c.set("phone",u);let m=`https://tourdriver.com/book?${c.toString()}`;window.location.href=m},window.handleContactUs=function(){let e=a("pickup_location"),o=a("dropoff_location"),s=a("passengers")||a("number_of_passengers")||t.defaultPassengers,n=`Hi! I'd like to book a transfer from ${e} to ${o} for ${s} passenger(s). Please contact me with more details.`,i=`https://wa.me/1876XXXXXXX?text=${encodeURIComponent(n)}`,r=`mailto:bookings@tourdriver.com?subject=Transfer Booking Request&body=${encodeURIComponent(n)}`;window.open(i,"_blank")}})();})();
/*!
 * Quote Calc Enhanced (Distance → Price) — results page widget with client-specific pricing
 * - Always shows total price (defaults to 1 passenger if none specified)
 * - Reads lead params (URL first, then sessionStorage fallback)
 * - Loads Google Maps JS (if not already present)
 * - Draws route map (DirectionsService/Renderer)
 * - Calculates price from client-specific distance bands + remote surcharge + minimum
 * - Supports client-specific pricing configuration from /clients/{client}.json
 *
 * Mount:   <div id="quote-calc"></div>
 * Depends: window.CFG.GMAPS_KEY (or a <script> with Maps already loaded)
 */
