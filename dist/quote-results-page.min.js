var QuoteResults=(()=>{var m="quote-calc",M={googleApiKey:window.CFG&&(window.CFG.GMAPS_KEY||window.CFG.PLACES_API_KEY)||"AIzaSyDomK0QVxMj2SzgbwIkUdlBZ2nyYxRJSOI",bands:[{maxMi:10,pricePP:30},{maxMi:20,pricePP:40},{maxMi:40,pricePP:55},{maxMi:999,pricePP:70}],minPricePP:30,defaultPassengers:1,remote:{keywords:["tryall","round hill","dublin castle","anchovy","greenwood","bluefields","sheffield","orange bay","rhodes hall"],surchargePP:5},map:{zoom:9}},n={...M};async function C(){try{let e=window.CFG?.client||new URLSearchParams(location.search).get("client")||sessionStorage.getItem("client")||"demo",o=window.CFG?.base||"krishnalewin-hash/tourism-ui-kit@main";console.log(`[quote-calc] Loading client config: ${e}`),console.log(`[quote-calc] Base URL: ${o}`);try{let s;o.startsWith("../")||o.startsWith("./")||o.startsWith("/")?s=`${o}/clients/_build/${e}.json`:s=`https://cdn.jsdelivr.net/gh/${o}/clients/_build/${e}.json`,console.log(`[quote-calc] Fetching built config: ${s}`);let t=await fetch(s,{cache:"no-store"});if(t.ok){let a=await t.json();return a.QUOTE_RESULTS_CONFIG?n={...n,...a.QUOTE_RESULTS_CONFIG}:a.PRICING_RATES&&P(a.PRICING_RATES),a.FORM_CONFIG?.GMAPS_KEY&&(n.googleApiKey=a.FORM_CONFIG.GMAPS_KEY),console.log(`[quote-calc] Successfully loaded ${e} configuration from built config`),n}else console.log(`[quote-calc] Built config returned ${t.status}: ${t.statusText}`)}catch(s){console.log(`[quote-calc] Built config fetch failed: ${s.message}`)}try{let s;o.startsWith("../")||o.startsWith("./")||o.startsWith("/")?s=`${o}/clients/${e}.json`:s=`https://cdn.jsdelivr.net/gh/${o}/clients/${e}.json`,console.log(`[quote-calc] Trying legacy config: ${s}`);let t=await fetch(s,{cache:"no-store"});if(t.ok){let a=await t.json();return a.QUOTE_RESULTS_CONFIG?n={...n,...a.QUOTE_RESULTS_CONFIG}:a.PRICING_RATES&&P(a.PRICING_RATES),a.FORM_CONFIG?.GMAPS_KEY&&(n.googleApiKey=a.FORM_CONFIG.GMAPS_KEY),console.log(`[quote-calc] Successfully loaded ${e} configuration from legacy config`),n}else console.log(`[quote-calc] Legacy config returned ${t.status}: ${t.statusText}`)}catch(s){console.log(`[quote-calc] Legacy config fetch failed: ${s.message}`)}return console.warn(`[quote-calc] No configuration found for ${e}, using defaults`),n}catch(e){return console.error("[quote-calc] Error loading client config:",e),n}}function P(e){if(e.DISTANCE_BANDS&&e.BASE_RATES){let o=e.BASE_RATES.SEDAN||120;n.bands=e.DISTANCE_BANDS.map(s=>({maxMi:Math.round(s.maxKm*.621371),pricePP:Math.round(o*s.multiplier)})),e.REMOTE_AREAS&&(n.remote.surchargePP=e.REMOTE_AREAS.SURCHARGE_USD||5)}else e.zones&&console.log("[quote-calc] Zone-based pricing detected, using default distance bands")}var E=new URLSearchParams(location.search),c=e=>{let o=E.get(e);if(o&&String(o).trim())return o;try{return sessionStorage.getItem("lead:"+e)||""}catch{return""}return window.LEAD_DATA&&window.LEAD_DATA[e]?window.LEAD_DATA[e]:""},w=e=>String(e||"").replace(/[<>&"']/g,o=>({"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"})[o]),$=e=>(e||0).toFixed(1)+" miles",k=e=>Math.round((e||0)/60)+" minutes";function I(e){for(let o of n.bands)if(e<o.maxMi)return o.pricePP;return n.bands[n.bands.length-1].pricePP}function T(e,o){let s=(e+" "+o).toLowerCase();for(let t of n.remote.keywords)if(s.includes(t))return n.remote.surchargePP;return 0}function G(e){let{pickup:o,dropoff:s,miles:t,seconds:a,pp:l,total:r,pax:d}=e;return`
      <div class="qc-row">
        <div>
          <div id="qc-map" class="qc-map qc-shimmer" aria-label="Route map"></div>
        </div>

        <div class="qc-details">
          <div class="qc-detail-item">
            <span class="qc-detail-label">From:</span>
            <span class="qc-detail-value">${w(o)}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">To:</span>
            <span class="qc-detail-value">${w(s)}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">Distance:</span>
            <span class="qc-detail-value">${$(t)}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">Est. Duration:</span>
            <span class="qc-detail-value">${k(a)}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">Number of Passengers:</span>
            <span class="qc-detail-value">${d||n.defaultPassengers}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">Cost per person:</span>
            <span class="qc-detail-value">$${l}</span>
          </div>
          <div class="qc-detail-item">
            <span class="qc-detail-label">Total Cost:</span>
            <span class="qc-detail-value highlight">$${r}</span>
          </div>
          
          <div class="qc-buttons">
            <button class="qc-btn qc-btn-primary" onclick="handlePayNow()">Pay Now</button>
            <button class="qc-btn qc-btn-secondary" onclick="handleContactUs()">Contact Us</button>
          </div>
        </div>
      </div>
    `}function N(){return`
      <div class="qc-row">
        <div class="qc-shimmer" style="height:400px;border-radius:12px;"></div>
        <div class="qc-shimmer" style="height:400px;border-radius:12px;"></div>
      </div>
    `}function L(e){if(console.log("[quote-calc] Loading Google Maps..."),window.google&&google.maps&&google.maps.DirectionsService)return console.log("[quote-calc] Google Maps already loaded"),e();let o=n.googleApiKey;if(console.log(`[quote-calc] Using API key: ${o?.substring(0,15)}...`),!o){console.error("[quote-calc] Missing Google Maps API key"),e("no-key");return}if(document.querySelector("script[data-qc-gmaps]")){console.log("[quote-calc] Google Maps script already exists, waiting for load...");let t=()=>window.google?.maps?.DirectionsService?e():setTimeout(t,100);t();return}console.log("[quote-calc] Creating Google Maps script tag");let s=document.createElement("script");s.src=`https://maps.googleapis.com/maps/api/js?key=${o}&libraries=places`,s.setAttribute("data-qc-gmaps","1"),s.onload=()=>{console.log("[quote-calc] Google Maps script loaded successfully"),e()},s.onerror=()=>{console.error("[quote-calc] Failed to load Google Maps"),e("load-error")},document.head.appendChild(s)}async function v(){let e=document.getElementById(m);if(!e){console.warn(`[quote-calc] No element #${m} found`);return}let o=c("pickup_location"),s=c("dropoff_location");if(console.log(`[quote-calc] Starting calculation with pickup: ${o}, dropoff: ${s}`),console.log(`[quote-calc] Initial CONFIG.googleApiKey: ${n.googleApiKey?.substring(0,15)}...`),!o||!s){e.innerHTML='<div class="qc-error">Missing pickup or dropoff location</div>';return}e.innerHTML=N();try{await C(),console.log(`[quote-calc] After config loading, CONFIG.googleApiKey: ${n.googleApiKey?.substring(0,15)}...`)}catch(t){console.warn("[quote-calc] Failed to load client config, using defaults:",t)}L(t=>{if(t){e.innerHTML=`<div class="qc-error">Could not load Google Maps: ${t}</div>`;return}new google.maps.DirectionsService().route({origin:o,destination:s,travelMode:google.maps.TravelMode.DRIVING},(l,r)=>{if(r!=="OK"){e.innerHTML=`<div class="qc-error">Couldn't calculate the route right now. Please try again.</div>`,console.error("[quote-calc] Directions failed:",r);return}let d=l.routes[0].legs[0],i=(d.distance?.value||0)/1609.344,p=d.duration?.value||0,g=c("passengers")||c("number_of_passengers"),h=g&&parseInt(g)>0?parseInt(g):n.defaultPassengers,b=I(i),y=T(o,s),q=Math.max(n.minPricePP,b+y),S=Math.round(q*h),f=document.createElement("div");f.id=m,f.innerHTML=G({pickup:o,dropoff:s,miles:Math.round(i*10)/10,seconds:p,pax:h,pp:q,total:S}),e.replaceWith(f);let _=document.getElementById("qc-map"),A=new google.maps.Map(_,{zoom:n.map.zoom||9});new google.maps.DirectionsRenderer({map:A}).setDirections(l),_.classList.remove("qc-shimmer")})})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",v):v();window.handlePayNow=function(){let e=c("pickup_location"),o=c("dropoff_location"),s=c("pickup_date"),t=c("pickup_time"),a=c("passengers")||c("number_of_passengers")||n.defaultPassengers,l=c("first_name"),r=c("last_name"),d=c("email"),u=c("phone"),i=new URLSearchParams;e&&i.set("pickup_location",e),o&&i.set("dropoff_location",o),s&&i.set("pickup_date",s),t&&i.set("pickup_time",t),a&&i.set("passengers",a),l&&i.set("first_name",l),r&&i.set("last_name",r),d&&i.set("email",d),u&&i.set("phone",u);let p=`https://tourdriver.com/book?${i.toString()}`;window.location.href=p};window.handleContactUs=function(){let e=c("pickup_location"),o=c("dropoff_location"),s=c("passengers")||c("number_of_passengers")||n.defaultPassengers,t=`Hi! I'd like to book a transfer from ${e} to ${o} for ${s} passenger(s). Please contact me with more details.`,a=`https://wa.me/1876XXXXXXX?text=${encodeURIComponent(t)}`,l=`mailto:bookings@tourdriver.com?subject=Transfer Booking Request&body=${encodeURIComponent(t)}`;window.open(a,"_blank")};})();
/*!
 * Quote Calc Enhanced (Distance → Price) — results page widget with client-specific pricing
 * - Always shows total price (defaults to 1 passenger if none specified)
 * - Reads lead params (URL first, then sessionStorage fallback)
 * - Loads Google Maps JS (if not already present)
 * - Draws route map (DirectionsService/Renderer)
 * - Calculates price from client-specific distance bands + remote surcharge + minimum
 * - Supports client-specific pricing configuration from /clients/{client}.json
 *
 * Mount:   <div id="quote-calc"></div>
 * Depends: window.CFG.GMAPS_KEY (or a <script> with Maps already loaded)
 */
